{"version":3,"file":"component---src-pages-implement-server-side-sdk-guides-on-device-decisioning-rule-artifact-json-md-8cb213cde5c7fd3a20cd.js","mappings":"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","sources":["webpack://target-developers/./src/pages/implement/server-side/sdk-guides/on-device-decisioning/rule-artifact-json.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/target-developers/target-developers/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst CodeBlock = makeShortcode(\"CodeBlock\");\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"downloading-storing-and-updating-the-rule-artifact-via-json-payload\"\n    }}>{`Downloading, Storing, and Updating the Rule Artifact via JSON Payload`}</h1>\n    <p>{`This approach is best if your application is structured in a way that requires the SDK to be initialized on each file in which it uses SDK methods. Before your web application can use the JSON payload of the rule artifact during SDK initialization, you should ensure the JSON payload is downloaded and is available for your application to use.`}</p>\n    <h2 {...{\n      \"id\": \"summary-of-steps\"\n    }}>{`Summary of steps`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`Install the SDK`}</li>\n      <li parentName=\"ol\">{`Initialize the SDK`}</li>\n      <li parentName=\"ol\">{`Store and Use the JSON Payload`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"install-the-sdk\"\n    }}>{`Install the SDK`}</h2>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, Java\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"npm\"\n    }}>{`NPM`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`npm i @adobe/target-nodejs-sdk -P\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"mvn\"\n    }}>{`MVN`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`<dependency>\n    <groupId>com.adobe.target</groupId>\n    <artifactId>java-sdk</artifactId>\n    <version>1.0</version>\n</dependency>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"initialize-the-sdk\"\n    }}>{`Initialize the SDK`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`First, import the SDK. Import to the same file from which you can control your server start-up.`}</li>\n    </ol>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, Java\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const TargetClient = require(\"@adobe/target-nodejs-sdk\");\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`To configure the SDK, use the create method.`}</li>\n    </ol>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, Java\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-1\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        artifactDownloadSucceeded: onArtifactDownloadSucceeded,\n        artifactDownloadFailed: onArtifactDownloadFailed\n    }\n};\n\nconst TargetClient = TargetClient.create(CONFIG);\n\nfunction onArtifactDownloadSucceeded(event) {\n    //Adobe Target SDK has now downloaded the JSON Artifact/Payload\n    console.log(event.artifactLocation) // Location from where the Artifact is downloaded.\n    console.log(event.artifactPayload) // JSON Payload which we can store locally.\n}\n\nfunction onArtifactDownloadFailed(event) {\n    //Adobe Target SDK has failed to download the JSON Artifact/Payload.\n    console.log(event.artifactLocation) // Location from where the Artifact is downloaded.\n    console.log(event.error.message) // Error message\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-1\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`package com.adobe.target.edge.client.model.ondevice.OnDeviceDecisioningHandler;\n\nClientConfig config = ClientConfig.builder()\n    .client(\"<you target client code>\")\n    .organizationId(\"<your EC org id>\")\n    .onDeviceDecisioningHandler(\n      new OnDeviceDecisioningHandler() {\n        void onDeviceDecisioningReady() {\n          // On-Device Decision is ready.\n        }\n        void artifactDownloadSucceeded(byte[] artifactData) {\n          // Store artifactData to local disk.        \n          // ...\n        }\n      }\n    )\n    .build();\nTargetClient targetClient = TargetClient.create(config);\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`Both client and `}<inlineCode parentName=\"li\">{`organizationId`}</inlineCode>{` can be retrieved from Adobe Target by navigating to `}<strong parentName=\"li\">{`Administration`}</strong>{` > `}<strong parentName=\"li\">{`Implementation`}</strong>{`, as shown here.`}</li>\n    </ol>\n    {\n      /*- Insert image-client-code.png -*/\n    }\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"36.5625%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/5530d/asset-rule-artifact-3.webp 320w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/0c8fb/asset-rule-artifact-3.webp 640w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/94b1e/asset-rule-artifact-3.webp 1280w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/0b34d/asset-rule-artifact-3.webp 1920w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/e25e3/asset-rule-artifact-3.webp 2172w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/dd4a7/asset-rule-artifact-3.png 320w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/0f09e/asset-rule-artifact-3.png 640w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/bbbf7/asset-rule-artifact-3.png 1280w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/ac7a9/asset-rule-artifact-3.png 1920w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/bc9c0/asset-rule-artifact-3.png 2172w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/bbbf7/asset-rule-artifact-3.png\",\n            \"alt\": \"alt image\",\n            \"title\": \"alt image\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <h2 {...{\n      \"id\": \"store-and-use-the-json-payload\"\n    }}>{`Store and Use the JSON Payload`}</h2>\n    <p>{`The mechanism you use to store the JSON payload depends on your system architecture. You can use a local file, a database, or a memory object caching system such as Memcached . You need to be able to read this JSON from your application for consumption. In this guide, we use a local file as the storage.`}</p>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, Java\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-2\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`//... Code removed for brevity\n\nfunction onArtifactDownloadSucceeded(event) {\n    const jsonPath = 'src/config/target-rules.json'\n    fs.writeFile(jsonPath, JSON.stringify(event.artifactPayload), 'utf8', (err) => {\n        if (err) {\n            throw err;\n        };\n        console.log(\\`The artifact from '\\${event.artifactLocation}' is now saved to '\\${jsonPath}'\\`);\n    });\n}\n\n\nfunction onArtifactDownloadFailed(event) {\n  console.log(\\`The local decisioning artifact failed to download from '\\${event.artifactLocation}' with the following error message: \\${event.error.message}\\`);\n}\n\n//... Code removed for brevity\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-2\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n    .context(new Context().channel(ChannelType.WEB))\n    .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n    .build();\nTargetDeliveryResponse response = targetClient.getOffers(request);\n`}</code></pre>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`By initializing the Adobe Target SDK via the JSON payload, your server is ready to serve requests immediately with on-device decisioning activities, since the Adobe Target SDK does not need to wait for the rule artifact to be downloaded.`}</p>\n    <p>{`Here is an example demonstrating the JSON payload-initializing capability.`}</p>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, Java\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-3\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady : startWebServer,\n        artifactDownloadSucceeded : onArtifactDownloadSucceeded,\n        artifactDownloadFailed : onArtifactDownloadFailed\n    },\n};\n\nfunction onArtifactDownloadSucceeded(event) {\n    const jsonPath = 'src/config/target-rules.json'\n    fs.writeFile(jsonPath, JSON.stringify(event.artifactPayload), 'utf8', (err) => {\n        if (err) {\n            throw err;\n        };\n        console.log(\\`The artifact from '\\${event.artifactLocation}' is now saved to '\\${jsonPath}'\\`);\n    });\n}\n\nfunction onArtifactDownloadFailed(event) {\n  console.log(\\`The on-device decisioning artifact failed to download from '\\${event.artifactLocation}' with the following error message: \\${event.error.message}\\`);\n}\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n  saveCookie(res, response.targetCookie);\n  res.status(200).send(response);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\nfunction startWebServer() {\n    app.get('/*', async (req, res) => {\n    const targetCookie = req.cookies[TargetClient.TargetCookieName];\n    const request = {\n        execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\" // Ensure that you have a LIVE Activity running on this location\n        }]\n        }};\n\n    try {\n        const response = await targetClient.getOffers({ request, targetCookie });\n        sendSuccessResponse(res, response);\n    } catch (error) {\n        console.error(\"Target:\", error);\n        sendErrorResponse(res, error);\n    }\n    });\n\n    app.listen(3000, function () {\n    console.log(\"Listening on port 3000 and watching!\");\n    });\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-3\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\nimport com.adobe.target.delivery.v1.model.ChannelType;\nimport com.adobe.target.delivery.v1.model.Context;\nimport com.adobe.target.delivery.v1.model.ExecuteRequest;\nimport com.adobe.target.delivery.v1.model.MboxRequest;\nimport com.adobe.target.edge.client.entities.TargetDeliveryRequest;\nimport com.adobe.target.edge.client.model.TargetDeliveryResponse;\n\n@Controller\npublic class TargetController {\n\n  private TargetClient targetClient;\n\n  TargetController() {\n    // You should instantiate TargetClient in a Bean and inject the instance into this class \n    // but we show the code here for demonstration purpose.\n    ClientConfig config = ClientConfig.builder()\n        .client(\"<you target client code>\")\n        .organizationId(\"<your EC org id>\")\n        .onDeviceDecisioningHandler(\n          new OnDeviceDecisioningHandler() {\n            void onDeviceDecisioningReady() {\n              // On-Device Decision is ready.\n            }\n            void artifactDownloadSucceeded(byte[] artifactData) {\n              // Store artifactData to local disk.        \n              // ...\n            }\n          }\n        )\n        .build();\n    targetClient = TargetClient.create(config);\n  }\n\n  @GetMapping(\"/\")\n  public String homePage() {\n    MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\n    TargetDeliveryRequest request = TargetDeliveryRequest.builder()\n        .context(new Context().channel(ChannelType.WEB))\n        .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n        .build();\n    TargetDeliveryResponse response = targetClient.getOffers(request);\n    // ...\n  }\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","makeShortcode","name","props","console","warn","CodeBlock","InlineAlert","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","slots","repeat","languages","variant","isMDXComponent"],"sourceRoot":""}