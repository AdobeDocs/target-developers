(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[6395],{32185:function(e,t,a){"use strict";a.r(t),a.d(t,{_frontmatter:function(){return l},default:function(){return c}});var n=a(22122),i=a(19756),o=(a(15007),a(64983)),r=a(99536),s=["components"],l={},p={_frontmatter:l},d=r.Z;function c(e){var t=e.components,a=(0,i.Z)(e,s);return(0,o.mdx)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"how-atjs-manages-flicker"},"How at.js manages flicker"),(0,o.mdx)("p",null,"Information about how the Target at.js JavaScript library prevents flicker during page or app load."),(0,o.mdx)("p",null,"Flicker happens when default content momentarily displays to visitors before it is replaced by the activity content. Flicker is undesirable because it can be confusing to visitors."),(0,o.mdx)("h2",{id:"using-an-auto-created-global-mbox"},"Using an auto-created global mbox"),(0,o.mdx)("p",null,"If you enable the ",(0,o.mdx)("a",{parentName:"p",href:"/target-developers/help/c-implementing-target/c-implementing-target-for-client-side-web/t-mbox-download/c-understanding-global-mbox/understanding-global-mbox.md#concept_76AC0EC995A048238F3220F53773DB13"},"Auto Create Global Mbox")," setting when configuring at.js, at.js manages flicker by changing the opacity setting as the page loads. When at.js loads, it will change the opacity setting of the ",(0,o.mdx)("inlineCode",{parentName:"p"},"<body>"),' element to "0", making the page initially invisible to visitors. After a response from Target is received—or if an error with the Target request is detected—at.js resets opacity to "1". This ensures that the visitor only sees the page after your activities\' content has been applied.'),(0,o.mdx)("p",null,"If you enable the setting when configuring at.js, at.js will set HTML BODY style opacity to 0. After a response from Target is received, at.js resets HTML BODY opacity to 1."),(0,o.mdx)("p",null,"Opacity set to 0 keeps the page content hidden to prevent flicker, but the browser still renders the page and loads all the necessary assets like CSS, images, etc."),(0,o.mdx)("p",null,"If opacity 0 does not work in your implementation, you can also manage flicker by customizing ",(0,o.mdx)("inlineCode",{parentName:"p"},"bodyHiddenStyle")," and set it to ",(0,o.mdx)("inlineCode",{parentName:"p"},"body {visibility:hidden !important}"),". You can use either value body ",(0,o.mdx)("inlineCode",{parentName:"p"},"{opacity:0 !important}")," or ",(0,o.mdx)("inlineCode",{parentName:"p"},"body {visibility:hidden !important}"),", whichever works best for your specific circumstance."),(0,o.mdx)("p",null,"The following illustration shows the Hide Body and Show Body calls in both at.js 1.",(0,o.mdx)("em",{parentName:"p"},"x")," and at.js 2.x."),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"at.js 2.x")),(0,o.mdx)("p",null,(0,o.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"974px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"56.25%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/cb523/atjs-20-flow-page-load-request.webp 320w","/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/797b9/atjs-20-flow-page-load-request.webp 640w","/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/c8839/atjs-20-flow-page-load-request.webp 974w"],sizes:"(max-width: 974px) 100vw, 974px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/72799/atjs-20-flow-page-load-request.png 320w","/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/6af66/atjs-20-flow-page-load-request.png 640w","/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/09e48/atjs-20-flow-page-load-request.png 974w"],sizes:"(max-width: 974px) 100vw, 974px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/target-developers/static/fdcc47f1c4bea9c42b234f7319303707/09e48/atjs-20-flow-page-load-request.png",alt:"Target flow: at.js page load request",title:"Target flow: at.js page load request",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"at.js 1.",(0,o.mdx)("em",{parentName:"strong"},"x"))),(0,o.mdx)("p",null,(0,o.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"674px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"52.81250000000001%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/cb523/target-flow2.webp 320w","/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/797b9/target-flow2.webp 640w","/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/4a65f/target-flow2.webp 674w"],sizes:"(max-width: 674px) 100vw, 674px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/72799/target-flow2.png 320w","/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/6af66/target-flow2.png 640w","/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/fdaf8/target-flow2.png 674w"],sizes:"(max-width: 674px) 100vw, 674px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/target-developers/static/084ad0e7cf9d01775c2e5ca9cca85495/fdaf8/target-flow2.png",alt:"alt image",title:"alt image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,o.mdx)("p",null,"For more information about the ",(0,o.mdx)("inlineCode",{parentName:"p"},"bodyHiddenStyle")," override, see ",(0,o.mdx)("a",{parentName:"p",href:"/target-developers/help/c-implementing-target/c-implementing-target-for-client-side-web/targetgobalsettings.md"},"targetGlobalSettings()"),"."),(0,o.mdx)("h2",{id:"managing-flicker-when-loading-atjs-asynchronously"},"Managing flicker when loading at.js asynchronously"),(0,o.mdx)("p",null,"Loading at.js asynchronously is a great way to avoid blocking the browser from rendering; however, this technique can lead to flicker on the web page."),(0,o.mdx)("p",null,"You can avoid flicker by using a pre-hiding snippet that will be visible after the relevant HTML elements are personalized by Target."),(0,o.mdx)("p",null,"at.js can be loaded asynchronously, either directly embedded on the page or via a tag manager (for example Adobe Experience Platform Launch)."),(0,o.mdx)("p",null,"If at.js is embedded on the page, the snippet must be added before loading at.js. If you load at.js via a tag manager, which is also loaded asynchronously, you must add the snippet before loading the tag manager. If the tag manager is loaded syncronously, the script might be included within the tag manager before at.js."),(0,o.mdx)("p",null,"The pre-hiding code snippet is as follows:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},";(function(win, doc, style, timeout) {\n  var STYLE_ID = 'at-body-style';\n\n  function getParent() {\n    return doc.getElementsByTagName('head')[0];\n  }\n\n  function addStyle(parent, id, def) {\n    if (!parent) {\n      return;\n    }\n\n    var style = doc.createElement('style');\n    style.id = id;\n    style.innerHTML = def;\n    parent.appendChild(style);\n  }\n\n  function removeStyle(parent, id) {\n    if (!parent) {\n      return;\n    }\n\n    var style = doc.getElementById(id);\n\n    if (!style) {\n      return;\n    }\n\n    parent.removeChild(style);\n  }\n\n  addStyle(getParent(), STYLE_ID, style);\n  setTimeout(function() {\n    removeStyle(getParent(), STYLE_ID);\n  }, timeout);\n}(window, document, \"body {opacity: 0 !important}\", 3000));\n")),(0,o.mdx)("p",null,"By default the snippet pre-hides the whole HTML BODY. In some cases, you may only want to pre-hide certain HTML elements and not the entire page. You can achieve that by customizing the style parameter. It can be replaced with something that pre-hides only particular regions of the page."),(0,o.mdx)("p",null,"For example, you have two regions identified by IDs container-1 and container-2, then the style can be replaced with the following:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"#container-1, #container-2 {opacity: 0 !important}\n")),(0,o.mdx)("p",null,"Instead of the default:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"body {opacity: 0 !important}\n")),(0,o.mdx)("h2",{id:"manage-flicker-in-atjs-2x-for-triggerview"},"Manage flicker in at.js 2.x for triggerView()"),(0,o.mdx)("p",null,"When using ",(0,o.mdx)("inlineCode",{parentName:"p"},"triggerView()")," to show targeted content in your SPA, flicker management is provided out of the box. This means that pre-hiding logic does not need to be added manually. Instead, at.js 2.x pre-hides the location where your view needs to be shown before applying the targeted content."),(0,o.mdx)("h2",{id:"manage-flicker-with-getoffer-and-applyoffer"},"Manage flicker with getOffer() and applyOffer()"),(0,o.mdx)("p",null,"Because both ",(0,o.mdx)("inlineCode",{parentName:"p"},"getOffer()")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"applyOffer()")," are low-level APIs, there is no built-in flicker control. You can pass a selector or HTML element as an option to ",(0,o.mdx)("inlineCode",{parentName:"p"},"applyOffer()"),", in this case ",(0,o.mdx)("inlineCode",{parentName:"p"},"applyOffer()")," adds the activity content to this particular element; however, you must make sure the element is properly pre-hidden before invoking ",(0,o.mdx)("inlineCode",{parentName:"p"},"getOffer()")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"applyOffer()"),"."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'document.documentElement.style.opacity = "0";\n \nadobe.target.getOffer({\n    mbox: \'target-global-mbox\',\n    success: function(offer) {\n        adobe.target.applyOffer({\n            mbox: \'target-global-mbox\',\n            offer: offer\n        });\n \n        document.documentElement.style.opacity = "1";\n    },\n    error: function() {\n        document.documentElement.style.opacity = "1";        \n    }\n});\n')),(0,o.mdx)("h2",{id:"using-a-regional-mbox-with-mboxcreate-in-atjs-1x-not-supported-in-atjs-2x"},"Using a regional mbox with mboxCreate() in at.js 1.x (not supported in at.js 2.x)"),(0,o.mdx)("p",null,"If you use a regional mbox implementation, you can use ",(0,o.mdx)("inlineCode",{parentName:"p"},"mboxCreate()")," with your page provisioned similar to the following sample code:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"<div class=\"mboxDefault\">\nSome default content\n</div>\n<script>\nmboxCreate('some-mbox');\n<\/script>\n")),(0,o.mdx)("p",null,'If your pages are properly provisioned, at.js manages flicker by appropriately switching the CSS "visibility" property of the element with the mboxDefault class.'))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-implement-client-side-how-atjs-works-manage-flicker-with-atjs-md-4c760bdccbc94bfacb9e.js.map