{"version":3,"sources":["webpack://dev-site-documentation-template/./src/pages/sdk-guides/integration-with-experience-cloud/experience-cloud-id-service.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"oTAQaA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,oCADR,uCAGA,eACE,GAAM,wCADR,2CAGA,8VACA,8DAA+C,uBAAYC,WAAW,KAAvB,cAA/C,yCAA8I,uBAAYA,WAAW,KAAvB,cAA9I,iCAAqO,uBAAYA,WAAW,KAAvB,yBAArO,+JAAqc,uBAAYA,WAAW,KAAvB,mBAArc,kCACA,qBAAK,iBAAMA,WAAW,OAAjB,4UAeL,eACE,GAAM,UADR,YAGA,qBAAK,iBAAMA,WAAW,OAAjB,04DAyEL,eACE,GAAM,QADR,SAGA,qBAAK,iBAAMA,WAAW,OAAjB,grCAoCL,eACE,GAAM,qCADR,sCAGA,wFAAyE,uBAAYA,WAAW,KAAvB,eAAzE,oCACA,qBAAK,iBAAMA,WAAW,OAAjB,4UAeL,eACE,GAAM,YADR,YAGA,qBAAK,iBAAMA,WAAW,OAAjB,62EA2FL,eACE,GAAM,UADR,SAGA,qBAAK,iBAAMA,WAAW,OAAjB,6mCA2BL,eACE,GAAM,kCADR,mCAGA,uMACA,sFACA,oBACE,eAAIA,WAAW,MAAf,mDACA,eAAIA,WAAW,MAAf,6EACA,eAAIA,WAAW,MAAf,0EACA,eAAIA,WAAW,MAAf,wFAEF,4LAA6K,uBAAYA,WAAW,KAAvB,qBAA7K,kHACA,qBAAK,iBAAMA,WAAW,OAAjB,8bAiBL,eACE,GAAM,YADR,YAGA,qBAAK,iBAAMA,WAAW,OAAjB,w1EAwFL,eACE,GAAM,UADR,SAGA,qBAAK,iBAAMA,WAAW,OAAjB,8wCA+BTJ,EAAWK,gBAAiB","file":"component---src-pages-sdk-guides-integration-with-experience-cloud-experience-cloud-id-service-md-da3bb079e2e43a70b1c8.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/target-developers/target-developers/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"experience-cloud-id-ecid-service\"\n    }}>{`Experience Cloud ID (ECID) Service`}</h1>\n    <h2 {...{\n      \"id\": \"experience-cloud-id-ecid-integration\"\n    }}>{`Experience Cloud ID (ECID) Integration`}</h2>\n    <p>{`Although using the Target SDKs for fetching content from Target can be powerful, the added value of using the Experience Cloud ID (ECID) for user tracking extends beyond Adobe Target. The ECID enables you to leverage Adobe Experience Cloud products and features, such as A4T reporting and Adobe Audience Manager (AAM) segments.`}</p>\n    <p>{`The ECID is generated and maintained by `}<inlineCode parentName=\"p\">{`visitor.js`}</inlineCode>{`, which maintains its own state. The `}<inlineCode parentName=\"p\">{`visitor.js`}</inlineCode>{` file creates a cookie named `}<inlineCode parentName=\"p\">{`AMCV_{organizationId}`}</inlineCode>{`, which is used by Target SDKs for ECID integration. When the Target response is returned, you need to update the Visitor instance on the client side with `}<inlineCode parentName=\"p\">{`thevisitorState`}</inlineCode>{` returned by the Target SDKs.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID (Visitor API) Integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <pre>Sample content</pre>\n</body>\n</html>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"nodejs\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n  client: \"acmeclient\",\n  organizationId: \"1234567890@AdobeOrg\"\n};\nconst TEMPLATE = \\`\n<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID (Visitor API) Integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <pre>\\${content}</pre>\n</body>\n</html>\n\\`;\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n// We assume that VisitorAPI.js is stored in \"public\" folder\napp.use(express.static(__dirname + \"/public\"));\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n\n  const result = TEMPLATE\n  .replace(\"\\${organizationId}\", CONFIG.organizationId)\n  .replace(\"\\${visitorState}\", JSON.stringify(response.visitorState))\n  .replace(\"\\${content}\", response);\n\n  saveCookie(res, response.targetCookie);\n\n  res.status(200).send(result);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\napp.get(\"/abtest\", async (req, res) => {\n  const visitorCookie = req.cookies[TargetClient.getVisitorCookieName(CONFIG.organizationId)];\n  const targetCookie = req.cookies[TargetClient.TargetCookieName];\n  const request = {\n      execute: {\n        mboxes: [{\n          address: { url: req.headers.host + req.originalUrl },\n          name: \"a1-serverside-ab\"\n        }]\n      }};\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`  console.log(\"Request\", request);\n\n  try {\n      const response = await targetClient.getOffers({ request, visitorCookie, targetCookie });\n      sendSuccessResponse(res, response);\n    } catch (error) {\n      sendErrorResponse(res, error);\n    }\n});\n\napp.listen(3000, function () {\n  console.log(\"Listening on port 3000 and watching!\");\n});\n@Controller\npublic class TargetControllerSample {\n\n  @Autowired\n  private TargetClient targetClient;\n\n  @GetMapping(\"/\")\n  public String targetMcid(Model model, HttpServletRequest request, HttpServletResponse response) {\n    Context context = getContext(request);\n    TargetDeliveryRequest targetDeliveryRequest = TargetDeliveryRequest.builder()\n        .context(context)\n        .prefetch(getPrefetchRequest())\n        .cookies(getTargetCookies(request.getCookies()))\n        .build();\n\n    TargetDeliveryResponse targetResponse = targetClient.getOffers(targetDeliveryRequest);\n    model.addAttribute(\"visitorState\", targetResponse.getVisitorState());\n    model.addAttribute(\"organizationId\", \"0DD934B85278256B0A490D44@AdobeOrg\");\n    setCookies(targetResponse.getCookies(), response);\n    return \"targetMcid\";\n  }\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"ecid-with-customer-id-integration\"\n    }}>{`ECID with Customer ID Integration`}</h2>\n    <p>{`In order to track visitor user accounts and login status details, `}<inlineCode parentName=\"p\">{`customerIds`}</inlineCode>{` may be passed via Target SDKs.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID (Visitor API) Integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <pre>Sample content</pre>\n</body>\n</html>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"nodejs-1\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n  client: \"acmeclient\",\n  organizationId: \"1234567890@AdobeOrg\"\n};\nconst TEMPLATE = \\`\n<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID (Visitor API) with Customer IDs Integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <pre>\\${content}</pre>\n</body>\n</html>\n\\`;\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n// We assume that VisitorAPI.js is stored in \"public\" folder\napp.use(express.static(__dirname + \"/public\"));\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n\n  const result = TEMPLATE\n  .replace(\"\\${organizationId}\", CONFIG.organizationId)\n  .replace(\"\\${visitorState}\", JSON.stringify(response.visitorState))\n  .replace(\"\\${content}\", response);\n\n  saveCookie(res, response.targetCookie);\n\n  res.status(200).send(result);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\napp.get(\"/abtest\", async (req, res) => {\n  const visitorCookie = req.cookies[TargetClient.getVisitorCookieName(CONFIG.organizationId)];\n  const targetCookie = req.cookies[TargetClient.TargetCookieName];\n  const customerIds = {\n      \"userid\": {\n        \"id\": \"67312378756723456\",\n        \"authState\": TargetClient.AuthState.AUTHENTICATED\n      }\n    };\n  const request = {\n    execute: {\n      mboxes: [{\n        address: { url: req.headers.host + req.originalUrl },\n        name: \"a1-serverside-ab\"\n      }]\n    }};\n\n  try {\n    const response = await targetClient.getOffers({ request, visitorCookie, targetCookie, customerIds });\n    sendSuccessResponse(res, response);\n  } catch (error) {\n    sendErrorResponse(res, error);\n  }\n});\n\napp.listen(3000, function () {\n  console.log(\"Listening on port 3000 and watching!\");\n});\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-1\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`@Controller\npublic class TargetControllerSample {\n\n  @Autowired\n  private TargetClient targetJavaClient;\n\n  @GetMapping(\"/targetMcid\")\n  public String targetMcid(Model model, HttpServletRequest request, HttpServletResponse response) {\n    Context context = getContext(request);\n    Map<String, CustomerState> customerIds = new HashMap<>();\n    customerIds.put(\"userid\", CustomerState.authenticated(\"67312378756723456\"));\n    customerIds.put(\"puuid\", CustomerState.unknown(\"550e8400-e29b-41d4-a716-446655440000\"));\n    TargetDeliveryRequest targetDeliveryRequest = TargetDeliveryRequest.builder()\n       .context(context)\n       .prefetch(getPrefetchRequest())\n       .cookies(getTargetCookies(request.getCookies()))\n       .customerIds(customerIds)\n       .build();\n\n    TargetDeliveryResponse targetResponse = targetJavaClient.getOffers(targetDeliveryRequest);\n    model.addAttribute(\"visitorState\", targetResponse.getVisitorState());\n    model.addAttribute(\"organizationId\", \"0DD934B85278256B0A490D44@AdobeOrg\");\n    setCookies(targetResponse.getCookies(), response);\n    return \"targetMcid\";\n  }\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"ecid-and-analytics-integration\"\n    }}>{`ECID and Analytics Integration`}</h2>\n    <p>{`To get the most out of the Target SDKs, and to use the powerful analytics capabilities provided by Adobe Analytics, you can use integrations across ECID, Analytics, and Target.`}</p>\n    <p>{`Using integrations across ECID, Analytics, and Target lets you:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Use segments from Adobe Audience Manager (AAM)`}</li>\n      <li parentName=\"ul\">{`Customize the user experience based on the content retrieved from Target`}</li>\n      <li parentName=\"ul\">{`Ensure that all events and success metrics are collected in Analytics`}</li>\n      <li parentName=\"ul\">{`Use Analytics' powerful queries and benefit from its awesome report visualizations`}</li>\n    </ul>\n    <p>{`Integrations across ECID, Analytics, and Target do not require any special handling for analytics on the server side. Instead, once you have the ECID integrated, add `}<inlineCode parentName=\"p\">{`AppMeasurement.js`}</inlineCode>{` (Analytics library) on the client side. Analytics then uses the Visitor instance to synchronize with Target.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID and Analytics integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <p>Sample content</p>\n  <script src=\"AppMeasurement.js\"></script>\n  <script>var s_code=s.t();if(s_code)document.write(s_code);</script>\n</body>\n</html>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"nodejs-2\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n  client: \"acmeclient\",\n  organizationId: \"1234567890@AdobeOrg\"\n};\nconst TEMPLATE = \\`\n<!doctype html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>ECID and Analytics integration Sample</title>\n  <script src=\"VisitorAPI.js\"></script>\n  <script>\n    Visitor.getInstance(\"\\${organizationId}\", {serverState: \\${visitorState}});\n  </script>\n</head>\n<body>\n  <p>\\${content}</p>\n  <script src=\"AppMeasurement.js\"></script>\n  <script>var s_code=s.t();if(s_code)document.write(s_code);</script>\n</body>\n</html>\n\\`;\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n// We assume that VisitorAPI.js and AppMeasurement.js are stored in \"public\" directory\napp.use(express.static(__dirname + \"/public\"));\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n\n  const result = TEMPLATE\n  .replace(\"\\${organizationId}\", CONFIG.organizationId)\n  .replace(\"\\${visitorState}\", JSON.stringify(response.visitorState))\n  .replace(\"\\${content}\", response);\n\n  saveCookie(res, response.targetCookie);\n\n  res.status(200).send(result);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n\n  res.status(500).send(error);\n}\n\napp.get(\"/abtest\", async (req, res) => {\n  const visitorCookie = req.cookies[TargetClient.getVisitorCookieName(CONFIG.organizationId)];\n  const targetCookie = req.cookies[TargetClient.TargetCookieName];\n  const request = {\n      execute: {\n        mboxes: [{\n          address: { url: req.headers.host + req.originalUrl },\n          name: \"a1-serverside-ab\"\n        }]\n      }};\n\n    try {\n      const response = await targetClient.getOffers({ request, visitorCookie, targetCookie });\n      sendSuccessResponse(res, response);\n    } catch (error) {\n      sendErrorResponse(res, error);\n    }\n});\n\napp.listen(3000, function () {\n  console.log(\"Listening on port 3000 and watching!\");\n});\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-2\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`@Controller\npublic class TargetControllerSample {\n\n    @Autowired\n    private TargetClient targetJavaClient;\n\n    @GetMapping(\"/targetAnalytics\")\n    public String targetMcid(Model model, HttpServletRequest request, HttpServletResponse response) {\n        Context context = getContext(request);\n        Map<String, CustomerState> customerIds = new HashMap<>();\n        customerIds.put(\"userid\", CustomerState.authenticated(\"67312378756723456\"));\n        customerIds.put(\"puuid\", CustomerState.unknown(\"550e8400-e29b-41d4-a716-446655440000\"));\n        TargetDeliveryRequest targetDeliveryRequest = TargetDeliveryRequest.builder()\n                .context(context)\n                .prefetch(getPrefetchRequest())\n                .cookies(getTargetCookies(request.getCookies()))\n                .customerIds(customerIds)\n                .trackingServer(\"imsbrims.sc.omtrds.net\")\n                .build();\n\n        TargetDeliveryResponse targetResponse = targetJavaClient.getOffers(targetDeliveryRequest);\n        model.addAttribute(\"visitorState\", targetResponse.getVisitorState());\n        model.addAttribute(\"organizationId\", \"0DD934B85278256B0A490D44@AdobeOrg\");\n        setCookies(targetResponse.getCookies(), response);\n        return \"targetAnalytics\";\n    }\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}