{"version":3,"sources":["webpack://dev-site-documentation-template/./src/pages/implement/server-side/sdk-guides/on-device-decisioning/rule-artifact-sdk.md"],"names":["_frontmatter","makeShortcode","name","props","console","warn","CodeBlock","InlineAlert","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","slots","repeat","languages","variant","isMDXComponent"],"mappings":"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","file":"component---src-pages-implement-server-side-sdk-guides-on-device-decisioning-rule-artifact-sdk-md-4df577d13a0e432daae3.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/target-developers/target-developers/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst CodeBlock = makeShortcode(\"CodeBlock\");\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"downloading-storing-and-updating-the-rule-artifact-automatically-via-the-adobe-target-sdk\"\n    }}>{`Downloading, Storing, and Updating the Rule Artifact Automatically via the Adobe Target SDK`}</h1>\n    <p>{`This approach is best when you are able to initialize the Adobe Target SDK at the same time you initialize and start your web server. The rule artifact will be downloaded by the Adobe Target SDK and cached into memory before your web server application starts serving requests. Once your web application is up and running, all Adobe Target decisions will be executed using the in-memory rule artifact. The cached rule artifact will be updated based on the `}<inlineCode parentName=\"p\">{`pollingInterval`}</inlineCode>{` you specify during the SDK initialization step.`}</p>\n    <h2 {...{\n      \"id\": \"summary-of-steps\"\n    }}>{`Summary of steps`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`Install the SDK`}</li>\n      <li parentName=\"ol\">{`Initialize the SDK`}</li>\n      <li parentName=\"ol\">{`Store and Use the Rule Artifact`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"install-the-sdk\"\n    }}>{`Install the SDK`}</h2>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, js\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"npm\"\n    }}>{`NPM`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`npm i @adobe/target-nodejs-sdk -P\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"mvn\"\n    }}>{`MVN`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`<dependency>\n    <groupId>com.adobe.target</groupId>\n    <artifactId>java-sdk</artifactId>\n    <version>1.0</version>\n</dependency>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"initialize-the-sdk\"\n    }}>{`Initialize the SDK`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`First, import the SDK. Import to the same file from which you can control your server start-up.`}</li>\n    </ol>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, js\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const TargetClient = require(\"@adobe/target-nodejs-sdk\");\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`To configure the SDK, use the create method.`}</li>\n    </ol>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, js\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-1\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady: startWebServer\n    }\n};\n\nconst TargetClient = TargetClient.create(CONFIG);\n\nfunction startWebServer() {\n    //Adobe Target SDK has now downloaded the JSON Artifacts and is available in the memory.\n    //You can start your web server now to serve requests now.\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-1\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`ClientConfig config = ClientConfig.builder()\n    .client(\"<you target client code>\")\n    .organizationId(\"<your EC org id>\")\n    .build();\nTargetClient targetClient = TargetClient.create(config);\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`Both client and organizationId can be retrieved from Adobe Target by navigating to `}<strong parentName=\"li\">{`Administration`}</strong>{` > `}<strong parentName=\"li\">{`Implementation`}</strong>{`, as shown here.`}</li>\n    </ol>\n    {\n      /*- Insert image-client-code.png -*/\n    }\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"36.5625%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/cb523/asset-rule-artifact-3.webp 320w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/797b9/asset-rule-artifact-3.webp 640w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/4b075/asset-rule-artifact-3.webp 1280w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/f3ff0/asset-rule-artifact-3.webp 1920w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/e672b/asset-rule-artifact-3.webp 2172w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/72799/asset-rule-artifact-3.png 320w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/6af66/asset-rule-artifact-3.png 640w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/21b4d/asset-rule-artifact-3.png 1280w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/29114/asset-rule-artifact-3.png 1920w\", \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/6976b/asset-rule-artifact-3.png 2172w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/target-developers/static/6d87e92d7dd1d0784641f75f957dfbd9/21b4d/asset-rule-artifact-3.png\",\n            \"alt\": \"alt image\",\n            \"title\": \"alt image\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <h2 {...{\n      \"id\": \"store-and-use-the-rule-artifact\"\n    }}>{`Store and Use the Rule Artifact`}</h2>\n    <p>{`You do not need to manage the rule artifact yourself and calling the SDK methods should be straightforward.`}</p>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, js\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-2\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`//req is the request object from the server request listener method\nconst targetCookie = req.cookies[TargetClient.TargetCookieName];\nconst request = {\n    context: {\n        channel: \"web\"\n    },\n    execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\"\n        }],\n    },\n};\n\nTargetClient.getOffers({\n    request,\n    targetCookie\n}).then(function(response) {\n    //This Target response is coming from the In-memory Target artifact.\n    console.log(\"Target response\", response);\n}).catch(function(err) {\n    console.error(\"Target:\", err);\n})\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-2\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{}}>{`MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n    .context(new Context().channel(ChannelType.WEB))\n    .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n    .build();\nTargetDeliveryResponse response = targetClient.getOffers(request);\n`}</code></pre>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`In the code sample above, the `}<inlineCode parentName=\"p\">{`TargetClient`}</inlineCode>{` object holds a reference to the in-memory rule artifact. When you use this object for invoking standard SDK methods, it uses the in-memory rule artifact for decisioning. If your application is structured such that you need to call the SDK methods in files other than the one that initializes and listens to client requests, and if those files do not have access to the TargetClient object, then you can download the JSON payload and store it in a local JSON file to be consumed on other files, which need to initialize the SDK. This is explained in the next section, regarding `}<a parentName=\"p\" {...{\n        \"href\": \"rule-artifact-json.md\"\n      }}>{`downloading the rule artifact using a JSON payload`}</a>{`.`}</p>\n    <p>{`Here is an example that starts a web application after initializing the Adobe Target SDK.`}</p>\n    <CodeBlock slots=\"heading, code\" repeat=\"2\" languages=\"js, js\" mdxType=\"CodeBlock\" />\n    <h3 {...{\n      \"id\": \"nodejs-3\"\n    }}>{`Node.js`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady: startWebServer\n    }\n};\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n  saveCookie(res, response.targetCookie);\n  res.status(200).send(response);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\nfunction startWebServer() {\n    app.get('/*', async (req, res) => {\n    const targetCookie = req.cookies[TargetClient.TargetCookieName];\n    const request = {\n        execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\" // Ensure that you have a LIVE Activity running on this location\n        }]\n        }};\n\n    try {\n        const response = await targetClient.getOffers({ request, targetCookie });\n        sendSuccessResponse(res, response);\n    } catch (error) {\n        console.error(\"Target:\", error);\n        sendErrorResponse(res, error);\n    }\n    });\n\n    app.listen(3000, function () {\n    console.log(\"Listening on port 3000 and watching!\");\n    });\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"java-3\"\n    }}>{`Java`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\nimport com.adobe.target.delivery.v1.model.ChannelType;\nimport com.adobe.target.delivery.v1.model.Context;\nimport com.adobe.target.delivery.v1.model.ExecuteRequest;\nimport com.adobe.target.delivery.v1.model.MboxRequest;\nimport com.adobe.target.edge.client.entities.TargetDeliveryRequest;\nimport com.adobe.target.edge.client.model.TargetDeliveryResponse;\n\n@Controller\npublic class TargetController {\n\n  private TargetClient targetClient;\n\n  TargetController() {\n    // You should instantiate TargetClient in a Bean and inject the instance into this class \n    // but we show the code here for demonstration purpose.\n    ClientConfig config = ClientConfig.builder()\n        .client(\"<you target client code>\")\n        .organizationId(\"<your EC org id>\")\n        .build();\n    targetClient = TargetClient.create(config);\n  }\n\n  @GetMapping(\"/\")\n  public String homePage() {\n    MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\n    TargetDeliveryRequest request = TargetDeliveryRequest.builder()\n        .context(new Context().channel(ChannelType.WEB))\n        .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n        .build();\n    TargetDeliveryResponse response = targetClient.getOffers(request);\n    // ...\n  }\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}