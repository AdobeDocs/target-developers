"use strict";(self.webpackChunktarget_developers=self.webpackChunktarget_developers||[]).push([[2756],{45927:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return s},default:function(){return h}});var a,r=n(87462),l=n(63366),i=(n(15007),n(64983)),d=n(91515),o=["components"],s={},m=(a="InlineAlert",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.mdx)("div",e)}),p={_frontmatter:s},u=d.Z;function h(e){var t=e.components,n=(0,l.Z)(e,o);return(0,i.mdx)(u,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"user-agent-and-client-hints"},"User-agent and Client Hints"),(0,i.mdx)("p",null,"Adobe Target uses the user-agent to qualify visitors for segmentation and personalization."),(0,i.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"The information in this article applies to ",(0,i.mdx)("a",{parentName:"p",href:"target-atjs-versions.md"},"at.js version 2.9.0")," (or later)."),(0,i.mdx)("p",null,"Each time a web browser makes a request to a server, information about the browser and the environment where the browser runs are included in the header of the request. Since the early days of the Internet, this data has been aggregated in a single string called the user-agent. "),(0,i.mdx)("p",null,"The following text is a sample user-agent of a Mac OS X-based computer using a Safari Browser:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"Mozilla/5.0 (Linux; Android 12; SM-S908E) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Mobile Safari/537.36 \n")),(0,i.mdx)("p",null,"From this user-agent, the server receiving the request can discern the following information about the browser and operating system: "),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Information"),(0,i.mdx)("th",{parentName:"tr",align:null},"Details"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Software name"),(0,i.mdx)("td",{parentName:"tr",align:null},"Chrome")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Software version"),(0,i.mdx)("td",{parentName:"tr",align:null},"101")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Full software version"),(0,i.mdx)("td",{parentName:"tr",align:null},"101.0.4951.41")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Layout engine name"),(0,i.mdx)("td",{parentName:"tr",align:null},"AppleWebKit")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Layout engine version"),(0,i.mdx)("td",{parentName:"tr",align:null},"537.36")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Operating system"),(0,i.mdx)("td",{parentName:"tr",align:null},"Android")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Operating system version"),(0,i.mdx)("td",{parentName:"tr",align:null},"Android 12 (Snow Cone)")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Device"),(0,i.mdx)("td",{parentName:"tr",align:null},"SM-S908E (Samsung Galaxy S22 Ultra)")))),(0,i.mdx)("p",null,"Over the years, the amount of browser and device information included in the user-agent string has grown. "),(0,i.mdx)("h2",{id:"user-agent-use-cases"},"User-agent use cases"),(0,i.mdx)("p",null,"User-agents have long been used to provide marketing and developer teams with important insights into how browsers, operating systems, and devices display site content, as well as how users interact with websites. User-agents are also used to block spam and filter bots that crawl sites for a variety of additional purposes. "),(0,i.mdx)("p",null,"However, in recent years some site owners and marketing vendors have used the user-agent along with other information included in request headers to create digital fingerprints that can be used as a means of identifying users without their knowledge. Despite the important purpose the user-agent serves for site owners, browser developers have decided to make changes to how user-agents operate to limit potential privacy issues for site visitors."),(0,i.mdx)("p",null,"Browser developers created User-Agent Client Hints as a solution to this challenge. Client Hints still allow sites to collect necessary browser, operating system, and device information, while also providing increased protection against covert tracking methods, such as fingerprinting."),(0,i.mdx)("h2",{id:"client-hints"},"Client Hints"),(0,i.mdx)("p",null,"User-Agent Client Hints provide website owners the ability to access much of the same information available in the user-agent, but in a more privacy-preserving way. When modern browsers send a user-agent to a web server, the entire user-agent is sent on every request, regardless of whether it is required. Client Hints, on the other hand, enforce a model where the server must ask the browser for the additional information it wants to know about the client. Upon receiving this request, the browser can apply its own policies or user-configuration to determine what data is returned. Instead of exposing the entire user-agent by default on all requests, access is now managed in an explicit and auditable fashion."),(0,i.mdx)("p",null,"User-Agent Client Hints have been available in Chrome since version 89. Recent versions of Chromium-based browsers, such as Microsoft Edge, Opera, Brave, Chrome Android, Opera Android, and Samsung Internet, also support the Client Hints API. "),(0,i.mdx)("p",null,"Client Hints contained in the headers of the first request made by the browser to a web server contain the browser brand, major version of the browser, and an indicator of whether the client is a mobile device. Each piece of data has its own header value, rather than being grouped into a single user-agent string."),(0,i.mdx)("p",null,"For example, here are some Client Hints:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'Sec-CH-UA: "Chromium";v="101", "Google Chrome";v="101", " Not;A Brand";v="99" \nSec-CH-UA-Mobile: ?0 \nSec-CH-UA-Platform: "macOS"\n')),(0,i.mdx)("p",null,"...whereas this is the user-agent for the same browser:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 \n")),(0,i.mdx)("p",null,"Although the information is similar, the first request to the server contains Client Hints that contain only a subset of what is available in the user-agent string. Missing from the request is the OS architecture, full OS version, layout engine name, layout engine version, and the full browser version. However, on subsequent requests, the Client Hints API does allow for web servers to ask for additional, high entropy details about the device. When these high entropy values are requested, depending on browser policy or user settings, the browser response can include that information. "),(0,i.mdx)("p",null,"The following example is a JSON object that is returned by the Client Hints API when high entropy values are requested:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'{ \n\n    "architecture":"x86", \n    "bitness":"64", \n    "brands":[ \n        { \n            "brand":" Not A;Brand", \n            "version":"99" \n        }, \n        { \n            "brand":"Chromium", \n            "version":"100" \n        }, \n        { \n            "brand":"Google Chrome", \n            "version":"100" \n        } \n    ], \n    "fullVersionList":[ \n        { \n            "brand":" Not A;Brand", \n            "version":"99.0.0.0" \n        }, \n        { \n            "brand":"Chromium", \n            "version":"100.0.4896.127" \n        }, \n        { \n            "brand":"Google Chrome", \n            "version":"100.0.4896.127" \n        } \n    ], \n    "mobile":false, \n    "model":"", \n    "platformVersion":"12.2.1" \n} \n')),(0,i.mdx)("p",null,"The high entropy values include several additional pieces of information that are not available in the default Client Hints information. The following table contains details of what data is available in the default request vs. the high entropy User-Agent Client Hints information."),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"HTTP header"),(0,i.mdx)("th",{parentName:"tr",align:null},"JavaScript"),(0,i.mdx)("th",{parentName:"tr",align:null},"User-agent"),(0,i.mdx)("th",{parentName:"tr",align:null},"Client hint"),(0,i.mdx)("th",{parentName:"tr",align:null},"High entropy client hint"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA"),(0,i.mdx)("td",{parentName:"tr",align:null},"brands"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Platform"),(0,i.mdx)("td",{parentName:"tr",align:null},"platform"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Mobile"),(0,i.mdx)("td",{parentName:"tr",align:null},"mobile"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Platform-Version"),(0,i.mdx)("td",{parentName:"tr",align:null},"platformVersion"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Arch"),(0,i.mdx)("td",{parentName:"tr",align:null},"architecture"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Model"),(0,i.mdx)("td",{parentName:"tr",align:null},"model"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Bitness"),(0,i.mdx)("td",{parentName:"tr",align:null},"Bitness"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},"Sec-CH-UA-Full-Version-List"),(0,i.mdx)("td",{parentName:"tr",align:null},"fullVersionList"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes"),(0,i.mdx)("td",{parentName:"tr",align:null},"No"),(0,i.mdx)("td",{parentName:"tr",align:null},"Yes")))),(0,i.mdx)("h2",{id:"migration-to-client-hints"},"Migration to Client Hints"),(0,i.mdx)("p",null,"Currently, Chromium-based browsers continue to send the user-agent along with Client Hints in the headers of requests made to web servers. However, starting in April 2022 and continuing through February 2023, the amount of data contained in the user-agent string will be reduced. Other browsers, such as Safari and Firefox, will continue to leverage the user-agent string; however, they too will be reducing the amount of information contained therein."),(0,i.mdx)("h2",{id:"target-use-cases-that-require-client-hints"},"Target use cases that require Client Hints"),(0,i.mdx)("p",null,"The following use cases in Target require Client Hints:"),(0,i.mdx)("h3",{id:"audience-attributes"},"Audience attributes"),(0,i.mdx)("p",null,"If you use Target audiences and use any of the following audience attributes, Target requires Client Hints to perform the correct segmentation: "),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Browser "),(0,i.mdx)("li",{parentName:"ul"},"Operating System "),(0,i.mdx)("li",{parentName:"ul"},"Mobile")),(0,i.mdx)("h3",{id:"profile-scripts"},"Profile scripts"),(0,i.mdx)("p",null,"If you use profile scripts and reference the ",(0,i.mdx)("inlineCode",{parentName:"p"},"user.browser")," attribute (which refers to user-agent), you might need to update the profile script to also check one or more Client Hints. You can access any of the Client Hints using the function ",(0,i.mdx)("inlineCode",{parentName:"p"},"user.clientHint('sec-ch-ua-xxxxx')"),". The Client Hint header name must be all lower-case.  "),(0,i.mdx)("p",null,"The following example shows how to properly detect a Windows OS in a profile script:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\"return (((user.browser != null) && (user.browser.indexOf(\\\"Windows\\\") > -1)) || \" + \n      \"((user.clientHint('sec-ch-ua-platform') != null) && \n(user.clientHint('sec-ch-ua-platform') === 'Windows')));\" \n")),(0,i.mdx)("p",null,"Here is a table of Client Hints and their corresponding profile script usage semantics."),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Client Hint header"),(0,i.mdx)("th",{parentName:"tr",align:null},"Entropy"),(0,i.mdx)("th",{parentName:"tr",align:null},"Audience Attribute"),(0,i.mdx)("th",{parentName:"tr",align:null},"Profile Script Usage"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA"},"Sec-CH-UA")),(0,i.mdx)("td",{parentName:"tr",align:null},"Low"),(0,i.mdx)("td",{parentName:"tr",align:null},"Browser"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Arch"},"Sec-CH-UA-Arch")),(0,i.mdx)("td",{parentName:"tr",align:null},"High"),(0,i.mdx)("td",{parentName:"tr",align:null},"Exposed to users via profile scripts"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-arch')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Bitness"},"Sec-CH-UA-Bitness")),(0,i.mdx)("td",{parentName:"tr",align:null},"High"),(0,i.mdx)("td",{parentName:"tr",align:null},"Exposed to users via profile scripts"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-bitness')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Full-Version-List"},"Sec-CH-UA-Full-Version-List")),(0,i.mdx)("td",{parentName:"tr",align:null},"High"),(0,i.mdx)("td",{parentName:"tr",align:null},"Browser"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-full-version-list')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Mobile"},"Sec-CH-UA-Mobile")),(0,i.mdx)("td",{parentName:"tr",align:null},"Low"),(0,i.mdx)("td",{parentName:"tr",align:null},"Mobile"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-mobile')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Model"},"Sec-CH-UA-Model")),(0,i.mdx)("td",{parentName:"tr",align:null},"High"),(0,i.mdx)("td",{parentName:"tr",align:null},"Mobile"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-model')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Platform"},"Sec-CH-UA-Platform")),(0,i.mdx)("td",{parentName:"tr",align:null},"Low"),(0,i.mdx)("td",{parentName:"tr",align:null},"Operating system"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-platform')"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-CH-UA-Platform-Version"},"Sec-CH-UA-Platform-Version")),(0,i.mdx)("td",{parentName:"tr",align:null},"High"),(0,i.mdx)("td",{parentName:"tr",align:null},"Exposed to users via profile scripts"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"user.clientHint('sec-ch-ua-platform-version')"))))),(0,i.mdx)("h2",{id:"how-to-pass-client-hints-to-adobe-target"},"How to pass Client Hints to Adobe Target"),(0,i.mdx)("p",null,"The following sections contain more information about how to pass Client Hints, depending on your Target implementation."),(0,i.mdx)("h3",{id:"atjs-version-290-or-later"},"at.js version 2.9.0 (or later)"),(0,i.mdx)("p",null,"Starting with at.js 2.9.0, User Agent Client Hints will be collected automatically from the browser and sent to Target when ",(0,i.mdx)("inlineCode",{parentName:"p"},"getOffer/getOffers()"),' is called. By default, at.js collects only "Low Entropy" Client Hints. If performing audience segmentation or using profile scripts based on data categorized as "High Entropy" from the preceding sections, you need to configure at.js to collect "High Entropy" Client Hints from the browser via ',(0,i.mdx)("inlineCode",{parentName:"p"},"targetGlobalSettings"),". "),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"window.targetGlobalSettings = { allowHighEntropyClientHints: true };\n")),(0,i.mdx)("h3",{id:"server-side-sdks"},"Server-side SDKs"),(0,i.mdx)("p",null,"For more information on how to pass Client Hints via server-side SDKs, see ",(0,i.mdx)("a",{parentName:"p",href:"../../server-side/sdk-guides/core-principles/audience-targeting.md#client-hints"},"Client Hints")," under Server-side Implementation documentation."))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-implement-client-side-atjs-user-agent-and-client-hints-md-f36f6edb67617949c327.js.map